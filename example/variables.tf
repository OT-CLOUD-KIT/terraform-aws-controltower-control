variable "controltower_controls" {
  type = map(object({
    all_controls          = optional(bool, false)
    specific_controls     = optional(map(string), {})
    not_specific_controls = optional(map(string), {})
  }))
  default = {
    "your_parent_OU_name/your_child_OU_name" = {
      all_controls = true
      not_specific_controls = {
        "AWS-GR_DETECT_CLOUDTRAIL_ENABLED_ON_SHARED_ACCOUNTS" = "Detect whether a shared account in the Security organizational unit has AWS CloudTrail or CloudTrail Lake enabled."
        "AWS-GR_AUDIT_BUCKET_PUBLIC_READ_PROHIBITED"          = "Detect public read access setting for log archive"
        "AWS-GR_AUDIT_BUCKET_PUBLIC_WRITE_PROHIBITED"         = "Detect public write access setting for log archive"
      }
    }
  }
}


variable "all_control_lists" {
  type = map(string)
  default = {
    ###############################################################################################
    ###############################################################################################
    ###############################################################################################
    ##################################### Detective controls ######################################
    ###############################################################################################
    ###############################################################################################
    ###############################################################################################
    
    "AWS-GR_EBS_OPTIMIZED_INSTANCE"                         = "Detect whether Amazon EBS optimization is enabled for Amazon EC2 instances"
    "AWS-GR_EC2_INSTANCE_NO_PUBLIC_IP"                      = "Detect whether any Amazon EC2 instance has an associated public IPv4 address"
    "AWS-GR_EC2_VOLUME_INUSE_CHECK"                         = "Detect whether Amazon EBS volumes are attached to Amazon EC2 instances"
    "AWS-GR_NO_UNRESTRICTED_ROUTE_TO_IGW"                   = "Detect whether public routes exist in the route table for an Internet Gateway (IGW)"
    "WHQJLTOONSGH"                                          = "Unused Network Access Control Lists should be removed"
    "LHHYJCUXFCSE"                                          = "EC2 subnets should not automatically assign public IP addresses"
    "YLBGCOIJCWCO"                                          = "API Gateway REST and WebSocket API execution logging should be enabled"
    "ZWRPSDCJJTPW"                                          = "API Gateway REST API stages should be configured to use SSL certificates for backend authentication"
    "RDTQSQGIEQUC"                                          = " API Gateway REST API stages should have AWS X-Ray tracing enabled"
    "RXPVPYDGQHYM"                                          = " API Gateway should be associated with a WAF Web ACL"
    "SZGAIYMXIFVU"                                          = "API Gateway REST API cache data should be encrypted at rest"
    "AWS-GR_EBS_SNAPSHOT_PUBLIC_RESTORABLE_CHECK"           = "Detect whether Amazon EBS snapshots are restorable by all AWS accounts"
    "SLCEEBHVDJFI"                                          = "EC2 instances should not use multiple ENIs"
    "CMOVKNTIMGOH"                                          = "Security groups should only allow unrestricted incoming traffic for authorized ports"
    "VYOUBCPPBFTY"                                          = "Security groups should not allow unrestricted access to ports with high risk"
    "SOUTWZRNWHMC"                                          = "Network ACLs should not allow ingress from 0.0.0.0/0 to port 22 or port 3389"
    "YSMQIQVOSFYA"                                          = "Unused EC2 security groups should be removed"
    "WKHAUMVQJHBL"                                          = "Attached EBS volumes should be encrypted at-rest"
    "XSSFYRGJZNXH"                                          = "VPC flow logging should be enabled in all VPCs"
    "YGQDRTWXYLOX"                                          = "EBS default encryption should be enabled"
    "BICIOKSBGCME"                                          = "EC2 instances should use Instance Metadata Service Version 2 (IMDSv2)"
    "DJYJFJKFZGNB"                                          = "EC2 instances should not have a public IPv4 address"
    "AWS-GR_AUTOSCALING_LAUNCH_CONFIG_PUBLIC_IP_DISABLED"   = "Detect whether public IP addresses for Amazon EC2 Auto Scaling are enabled through launch configurations"
    "RJDQSGGXMFNH"                                          = "Auto scaling groups associated with a load balancer should use load balancer health checks"
    "VFWAYLBRJFYI"                                          = "Amazon EC2 Auto Scaling group should cover multiple Availability Zones"
    "LPSGVWSPBFOM"                                          = "Auto Scaling group launch configurations should configure EC2 instances to require Instance Metadata Service Version 2 (IMDSv2)"
    "HAQJHOURKUHX"                                          = "Auto Scaling group launch configuration should not have a metadata response hop limit greater than 1"
    "NRPXJATICULB"                                          = "Amazon EC2 instances launched using Auto Scaling group launch configurations should not have Public IP addresses"
    "UHHKZSLKXCPG"                                          = "EC2 Auto Scaling groups should use EC2 launch templates"
    "FKTCYLYWJYFL"                                          = "ECR private repositories should have image scanning configured"
    "LOYORBYGCYNU"                                          = "ECR private repositories should have tag immutability configured"
    "AMXIUAVTMARH"                                          = "ECR repositories should have at least one lifecycle policy configured"
    "DZKNSGRUQHTT"                                          = "Amazon ECS task definitions should have secure networking modes and user definitions"
    "SUDPRJEDUAWI"                                          = "ECS Fargate services should run on the latest Fargate platform version"
    "XAFJJVQHMGNX"                                          = "ECS clusters should use Container Insights"
    "OCQSRQOSDJOY"                                          = "ECS services should not have public IP addresses assigned to them automatically"
    "ZMMJVDDXRGGF"                                          = "ECS task definitions should not share the host's process namespace"
    "YEZCUVRWIYFA"                                          = "ECS containers should run as non-privileged"
    "AFNCBEGBYIXM"                                          = "ECS containers should be limited to read-only access to root filesystems"
    "KANMMZEMJFTV"                                          = "Secrets should not be passed as container environment variables"
    "YPEWSZCWJIUR"                                          = "Kinesis streams should be encrypted at rest"
    "AWS-GR_ELASTICSEARCH_IN_VPC_ONLY"                      = "Detect whether an Amazon OpenSearch Service domain is in Amazon VPC"
    "SCVOJNYHGDOL"                                          = "Elasticsearch domains should have encryption at-rest enabled"
    "NOKXLSVSZDSE"                                          = "Elasticsearch domains should be in a VPC"
    "OZYVQTZLOGQO"                                          = "Elasticsearch domains should encrypt data sent between nodes"
    "TIPBMSRPMONC"                                          = "Elasticsearch domain error logging to CloudWatch Logs should be enabled"
    "YVMKOVTHFRNH"                                          = "Elasticsearch domains should have audit logging enabled"
    "GLOMYATYELRZ"                                          = "Elasticsearch domains should have at least three data nodes"
    "PTXYSYHARCVA"                                          = "Elasticsearch domains should be configured with at least three dedicated master nodes"
    "QVPGWCRCBGPS"                                          = "Connections to Elasticsearch domains should be encrypted using TLS 1.2"
    "UBZMNDYJFFGL"                                          = "OpenSearch domains should have encryption at rest enabled"
    "HTJOZSBBCWOS"                                          = "OpenSearch domains should be in a VPC"
    "LDDCEQCAMDTZ"                                          = "OpenSearch domains should encrypt data sent between nodes"
    "FBETLNTPIXIH"                                          = "OpenSearch domain error logging to CloudWatch Logs should be enabled"
    "GZUMMDQRRYGL"                                          = "OpenSearch domains should have audit logging enabled"
    "AHZDAVZEIKPI"                                          = "OpenSearch domains should have at least three data nodes"
    "AWWBNORXHGFQ"                                          = "OpenSearch domains should have fine-grained access control enabled"
    "YRWIMCSZLLAG"                                          = "Connections to OpenSearch domains should be encrypted using TLS 1.2"
    "AWS-GR_RDS_INSTANCE_PUBLIC_ACCESS_CHECK"               = "Detect whether public access to Amazon RDS database instances is enabled"
    "AWS-GR_RDS_SNAPSHOTS_PUBLIC_PROHIBITED"                = "Detect whether public access to Amazon RDS database snapshots is enabled"
    "AWS-GR_RDS_STORAGE_ENCRYPTED"                          = "Detect whether storage encryption is enabled for Amazon RDS database instances"
    "EHMNWTQNUQFX"                                          = "RDS snapshot should be private"
    "RYHNWNNMLODQ"                                          = "IAM authentication should be configured for RDS instances"
    "YITLGYAIRUBP"                                          = "RDS instances should have automatic backups enabled"
    "SJKOVPHPKCSE"                                          = "RDS automatic minor version upgrades should be enabled"
    "YVFDAUWENFAA"                                          = "RDS DB instances should be configured to copy tags to snapshots"
    "WUNIHEUEMUJR"                                          = "RDS instances should be deployed in a VPC"
    "FNYIMXTFODXS"                                          = "An RDS event notifications subscription should be configured for critical cluster events"
    "QPXOSOOJYDOD"                                          = "RDS DB Instances should prohibit public access, as determined by the PubliclyAccessible configuration"
    "NVFJXDYXEZUI"                                          = "An RDS event notifications subscription should be configured for critical database instance events"
    "MUDGOLDWJQFJ"                                          = "An RDS event notifications subscription should be configured for critical database parameter group events"
    "QUVLHKDDEGEY"                                          = "An RDS event notifications subscription should be configured for critical database security group events"
    "FAFQHCERANWF"                                          = "RDS instances should not use a database engine default port"
    "AWJUNDMLTRRD"                                          = "RDS database instances should use a custom administrator username"
    "QLBPHXRQYFTE"                                          = "RDS DB instances should have encryption at-rest enabled"
    "DACICEFQAULS"                                          = "RDS cluster snapshots and database snapshots should be encrypted at rest"
    "GPUFSACIRWXI"                                          = "RDS DB instances should be configured with multiple Availability Zones"
    "VHPWTYRBFSMR"                                          = "Enhanced monitoring should be configured for RDS DB instances"
    "LWZRQWERBHQG"                                          = "RDS DB instances should have deletion protection enabled"
    "KAQQDXQFJYRU"                                          = "Database logging should be enabled"
    "AWS-GR_REDSHIFT_CLUSTER_PUBLIC_ACCESS_CHECK"           = "Detect whether Amazon Redshift clusters are blocked from public access"
    "WXXRGRFXMKHZ"                                          = "Amazon Redshift clusters should prohibit public access"
    "NDBMIIUJFYKY"                                          = "Connections to Amazon Redshift clusters should be encrypted in transit"
    "JHIVYPBOODHM"                                          = "Amazon Redshift clusters should have audit logging enabled"
    "WWTYVIKOAEOM"                                          = "Amazon Redshift should have automatic upgrades to major versions enabled"
    "QTIUHWEMWAMC"                                          = "Redshift clusters should use enhanced VPC routing"
    "LNLPIBKGAUQR"                                          = "Amazon Redshift clusters should not use the default Admin username"
    "DNJVACRRVQMJ"                                          = "Redshift clusters should not use the default database name"
    "AWS-GR_S3_ACCOUNT_LEVEL_PUBLIC_ACCESS_BLOCKS_PERIODIC" = "Detect whether Amazon S3 settings to block public access are set as true for the account"
    "AWS-GR_S3_BUCKET_PUBLIC_READ_PROHIBITED"               = "Detect whether public read access to Amazon S3 buckets is allowed"
    "AWS-GR_S3_BUCKET_PUBLIC_WRITE_PROHIBITED"              = "Detect whether public write access to Amazon S3 buckets is allowed"
    "AWS-GR_S3_VERSIONING_ENABLED"                          = "Detect whether versioning for Amazon S3 buckets is enabled"
    "DDFXZZZGUALP"                                          = "S3 Block Public Access setting should be enabled"
    "KPCTMBEDXBVA"                                          = "S3 buckets with versioning enabled should have lifecycle policies configured"
    "RFTVXUXSDPBJ"                                          = "S3 buckets should have event notifications enabled"
    "QYSZQBRLIVHX"                                          = "S3 access control lists (ACLs) should not be used to manage user access to buckets"
    "EKXYSHHNTFGF"                                          = "S3 buckets should have lifecycle policies configured"
    "WQFTUQOYEPUO"                                          = "S3 buckets should prohibit public read access"
    "MUMHADVUHEXE"                                          = "S3 buckets should prohibit public write access"
    "NUPCQDXDAERA"                                          = "S3 buckets should have server-side encryption enabled"
    "OJXAXIGHYFQW"                                          = "S3 buckets should require requests to use Secure Socket Layer"
    "DBISINHULBGV"                                          = "S3 permissions granted to other AWS accounts in bucket policies should be restricted"
    "HTLHSBYDSNKX"                                          = "S3 Block Public Access setting should be enabled at the bucket-level"
    "THYMKLHAVMWC"                                          = "S3 bucket server access logging should be enabled"
    "AWS-GR_SAGEMAKER_NOTEBOOK_NO_DIRECT_INTERNET_ACCESS"   = "Detect whether an Amazon SageMaker notebook instance allows direct internet access"
    "DGBAJFFOFTUB"                                          = "Amazon SageMaker notebook instances should not have direct internet access"
    "WDDSEPDQGELD"                                          = "SNS topics should be encrypted at-rest using AWS KMS"
    "EFGSSRJSCQHJ"                                          = "Logging of delivery status should be enabled for notification messages sent to a topic"
    "OCRDEAEBDMNJ"                                          = "Amazon SQS queues should be encrypted at rest"
    "WIULDPIAKWSU"                                          = "Both VPN tunnels for an AWS Site-to-Site VPN connection should be up"
    "VPNPOEIIUSHA"                                          = "Imported and ACM-issued certificates should be renewed after a specified time period"
    "AWS-GR_DETECT_CLOUDTRAIL_ENABLED_ON_MEMBER_ACCOUNTS"   = "Detect whether an account has AWS CloudTrail or CloudTrail Lake enabled."
    "AWS-GR_DETECT_CLOUDTRAIL_ENABLED_ON_SHARED_ACCOUNTS"   = "Detect whether a shared account in the Security organizational unit has AWS CloudTrail or CloudTrail Lake enabled."
    "HDXRGASZIBJR"                                          = "CloudTrail should be enabled and configured with at least one multi-Region trail that includes read and write management events"
    "BJKTTLYAWQNP"                                          = "CloudTrail should have encryption at-rest enabled"
    "WYJYQDZHOUMC"                                          = "CloudTrail log file validation should be enabled"
    "TNFFXMMEKNUK"                                          = "CloudTrail trails should be integrated with Amazon CloudWatch Logs"
    "ICYKSDRBZJBO"                                          = "CodeBuild GitHub or Bitbucket source repository URLs should use OAuth"
    "RBONONXLXNLM"                                          = "CodeBuild project environment variables should not contain clear text credentials"
    "VZJSHORKBLYN"                                          = "CodeBuild project environments should have a logging configuration"
    "LSISWPBSPNUR"                                          = "CodeBuild project environments should not have privileged mode enabled"
    "AWS-GR_DMS_REPLICATION_NOT_PUBLIC"                     = "Detect whether replication instances for AWS Database Migration Service are public"
    "GIDDGGAFOUJI"                                          = "Database Migration Service replication instances should not be public"
    "TJVUCTRUZXBI"                                          = "Elastic Beanstalk environments should have enhanced health reporting enabled"
    "DWGNUKILACZO"                                          = "Elastic Beanstalk managed platform updates should be enabled"
    "AWS-GR_IAM_USER_MFA_ENABLED"                           = "Detect whether MFA is enabled for AWS IAM users"
    "AWS-GR_MFA_ENABLED_FOR_IAM_CONSOLE_ACCESS"             = "Detect whether MFA is enabled for AWS IAM users of the AWS Console"
    "AWS-GR_ROOT_ACCOUNT_MFA_ENABLED"                       = "Detect whether MFA for the root user is enabled"
    "TENOMRDYBHFD"                                          = "IAM policies should not allow full  '*'  administrative privileges"
    "RYBHHGRLQNRS"                                          = "IAM users should not have IAM policies attached"
    "WFVNBRNTREIU"                                          = "IAM customer managed policies that you create should not allow wildcard actions for services"
    "RFHKMYZYMHYO"                                          = "IAM users' access keys should be rotated every 90 days or less"
    "MYNFRQFMIDRC"                                          = "IAM root user access key should not exist"
    "MAJHPOEPBKQN"                                          = "MFA should be enabled for all IAM users that have a console password"
    "HIVWUODPEDII"                                          = "Hardware MFA should be enabled for the root user"
    "XADXTOPDEFZN"                                          = "Password policies for IAM users should have strong configurations"
    "FKPJQKAODREW"                                          = "Unused IAM user credentials should be removed"
    "IGBZSWRYBKOJ"                                          = "IAM customer managed policies should not allow decryption actions on all KMS keys"
    "JBHOZLAJZRHT"                                          = "IAM principals should not have IAM inline policies that allow decryption actions on all KMS keys"
    "APZNZRNDYXHH"                                          = "AWS KMS keys should not be deleted unintentionally"
    "AWS-GR_LAMBDA_FUNCTION_PUBLIC_ACCESS_PROHIBITED"       = "Detect whether the AWS Lambda function policy attached to the Lambda resource blocks public access"
    "WLOTGENGLMYP"                                          = "Lambda function policies should prohibit public access"
    "BHBSEUQUFGWL"                                          = "Lambda functions should use supported runtimes"
    "PYKSDWCTUPJJ"                                          = "VPC Lambda functions should operate in more than one Availability Zone"
    "KXECUOXEPWAE"                                          = "Network Firewall policies should have at least one rule group associated"
    "HAHSWPLBYDBY"                                          = "The default stateless action for Network Firewall policies should be drop or forward for full packets"
    "OWXSVHKINPIX"                                          = "The default stateless action for Network Firewall policies should be drop or forward for fragmented packets"
    "AYDXHNXYPDCX"                                          = "Stateless network firewall rule group should not be empty"
    "VCDOMBQOZAKF"                                          = "Secrets Manager secrets should have automatic rotation enabled"
    "LOGBIWTPOFLX"                                          = "Secrets Manager secrets configured with automatic rotation should rotate successfully"
    "DRWDDUMJXGDX"                                          = "Remove unused Secrets Manager secrets"
    "MFXRVGDHFFAU"                                          = "Secrets Manager secrets should be rotated within a specified number of days"
    "AWS-GR_SSM_DOCUMENT_NOT_PUBLIC"                        = "Detect whether AWS Systems Manager documents owned by the account are public"
    "ISTITQJTNGSD"                                          = "EC2 instances should be managed by AWS Systems Manager"
    "CWXNZUPFQUJG"                                          = "EC2 instances managed by Systems Manager should have a patch compliance status of COMPLIANT after a patch installation"
    "CVEGWZBOLQVU"                                          = "EC2 instances managed by Systems Manager should have an association compliance status of COMPLIANT"
    "XRDYUTEVYMMA"                                          = "SSM documents should not be public"
    "DLOLIYYVEVKV"                                          = "A WAF Regional rule should have at least one condition"
    "BXSAQBULUHIU"                                          = "A WAF Regional rule group should have at least one rule"
    "ZGIHYMZBHXMV"                                          = "A WAF Regional web ACL should have at least one rule or rule group"
    "SNUVEKZNARWV"                                          = "Classic Load Balancer should span multiple Availability Zones"
    "LKVZZNIHLSAG"                                          = "Application Load Balancer should be configured with defensive or strictest desync mitigation mode"
    "WMXUZBXGIQWF"                                          = "Application, Network and Gateway Load Balancers should span multiple Availability Zones"
    "GFCILRDCWFSU"                                          = "Classic Load Balancer should be configured with defensive or strictest desync mitigation mode"
    "QIAVFQEMYPRM"                                          = "Classic Load Balancers with SSL/HTTPS listeners should use a certificate provided by AWS Certificate Manager"
    "KTZTXRNIMGCY"                                          = "Classic Load Balancer listeners should be configured with HTTPS or TLS termination"
    "YCLAVFMLZXCO"                                          = "Application load balancer should be configured to drop http headers"
    "FOTLYKSQLKLV"                                          = "Application and Classic Load Balancers logging should be enabled"
    "QECHNAARNAON"                                          = "Application Load Balancer deletion protection should be enabled"
    "IKKHFUAQZUVN"                                          = "Classic Load Balancers should have connection draining enabled"
    "BBKARSAMZQXX"                                          = "Classic Load Balancers with SSL listeners should use a predefined security policy that has strong configuration"
    "SVECMBMGSKGW"                                          = "Classic Load Balancers should have cross-zone load balancing enabled"
    "BATAGMQWYONM"                                          = "Application Load Balancer should be configured to redirect all HTTP requests to HTTPS"
    "AWS-GR_AUDIT_BUCKET_PUBLIC_READ_PROHIBITED"            = "Detect public read access setting for log archive"
    "AWS-GR_AUDIT_BUCKET_PUBLIC_WRITE_PROHIBITED"           = "Detect public write access setting for log archive"
  }
}